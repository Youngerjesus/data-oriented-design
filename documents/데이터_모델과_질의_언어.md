# 데이터 모델과 질의 언어 

## Intro 

- 여기서는 다양한 데이터 모델에 대해서 알아본다. 
  - 관계형 데이터 베이스에 저장하는 모델, 문서 모델 (documented-model), 그래프 기반 데이터 모델 (graph-based data model) 을 알아보겠다.
- 데이터 모델을 알아보는 이유는 어떤 데이터 모델을 쓰는지에 따라 성능이 다르기도 하다 (어떤 연산은 느리고, 어떤 연산은 빠르다.)
- 그리고 데이터 모델을 어플리케이션에서 사용하도록 하는 방식도 다를 수 있다. 
- 이런 데이터 모델을 알아야 어플리케이션 개발을 쉽게 할 수 있을 것. 

## 관계형 모델과 문서 모델 

- 관계형 데이터베이스의 근원 
  - 1960~70 년대에 비즈니스 데이터 처리를 위해서 태어났다. 
  - 이 사용사례는 트랜잭션 처리 (은행 거래 등) 이나 일괄 처리 (고객 송장 작성, 급여 지불 등) 을 위해서 태어남.
  - 물론 이후에 많은 데이터베이스가 생겨났지만 관계형 DB 는 이기지 못함.
  - 이제는 이 목적 이외에 웹, Sass, 커뮤니티 등 다양한 곳에서 사용함.
- NoSQL (Not Only SQL) 의 탄생 
  - **대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 더 잘할 수 있음.**
    - **더 나은 성능을 위해서 쓴다.**
  - 상용 데이터베이스보다 오픈소스 소프트웨어에 대한 선호도 혁신 
  - 관계형 모델에서 지원하지 않는 특수한 질의 
  - 스키마 제한에 대한 불편함. 동적인 데이터를 표현하기 위함.
- 어플리케이션은 각각의 요구사항이 다르다. 그러므로 미래에는 관계형 DB 와 NoSQL 을 같이 쓰는 미래가 올 것. 이를 다중 저장소 지원 (polyglot persistence) 라고한다. 
- 링크드인의 이력서를 저장하고 불러오는 기능을 만든다고 생각해보자.
  - SQL 로 쓰면 유저 정보와, 이력 정보, 학교 정보 모든 정보들을 조인해서 수행해야한다.
  - MongoDB 를 쓴다면 이력서 정보는 하나의 문서 그 자체다. 하나의 쿼리만 수행하면 된다. 
  - **이런 점을 비교해볼 때 NoSQL 의 몽고 DB 는 SQL 보다 지역성 (locality) 이 좋다. 쿼리를 단순하게 유지할 수 있다.**

### 다대일과 다대다 모델 

- 링크드인의 이력서 정보를 더 보면 살고 있는 region 과 일한 산업인 industry 를 텍스트가 아닌 id 로 받고 있다.
  - 즉 user 테이블에 region_id 와 industry_id 를 받고 있는 것. 살고 있는 지격 이름을 받는게 아니라. 
  - 이로 인해서 일관된 데이터를 유지하게 할 수 있다. 갱신하기도 편리하고 (정규화를 잘 지킨것이기도 함.)
    - 중복을 피하니까.
- 즉 user 와 region 그리고 user 와 industry 는 다대일 (many-to-one) 의 관계를 띄게된다. 
- 다대일 (many-to-one) 의 장점은 중복된 데이터를 쉽게 업데이트할 수 있다는 장점이 있다. 
- 다만 다대일 관계는 문서 모델에는 이게 어울리지 않는다. 조인이 필요하기 떄문에.
  - 조인을 지원하지 않는 NoSQL 은 흉내내기 위해서 다중 쿼리를 써야한다.
- 문서 모델은 일대다 (one-to-many) 에 강하다. (쿼리 개수를 줄여주기 떄문에.)
- **근데 일대다, 다대일 한 종류만 지원하는 도메인이 있을까? 최상의 케이스를 노리기만 하는건 현실적이지 않을듯.**
  - **애플리케이션 초기 버전에 조인이 필요없는 경우더라도 확장되면서 조인이 필요하게 되는 경우도 꽤 빈번하다. 이 점도 고려하자.**
  - 이력서에 추천서 기능을 넣는다고 가정해보면 다대다 (many-to-many) 기능이 추가될 수 있을 것.

### 관계형 데이터 모델과 문서형 모델의 비교 

- **실제로 비교할 떈 fault-tolerance (5장) 과 동시성 (7장) 도 같이 비교를 해봐야하지만 데이터 모델만을 비교해보면 문서 모델은 locality 와 스키마 유연성 떄문에 쓴다. 관계형 모델은 다대일, 다대다 와 같은 표현의 조인 때문에 쓰고.**

## 그래프형 데이터 모델 

- 다대다 관계가 많을 떄 그래프형 데이터 모델을 이용할 수 있다. 이게 더 자연스럽다는 듯. 엄청난 조인을 쓰는 것보다.
- 그래프형 데이터 모델은 두 객체로 이뤄진다.
  - vertex (점정)
  - edge (간선)
- 주로 사용하는 usecase 는 소셜 네트워크, 도로 최단거리에 쓰임.
- 그래프 모델의 데이터 구조화는 속성 그래프 모델과 트리플 저장소 모델이 있음
  - 속성 그래프 모델
    - 정점
      - 고유한 식별자
      - outgoing 간선 집합
      - income 간선 집합
      - 속성 컬렉션
    - 간선
      - 고유 식별자
      - 간선이 시작되는 정점 
      - 간선이 끝나는 정점 
      - 두 정점 간 관계 유형을 설명하는 테이블 
      - 속성 컬렉션
```sql
CREATE TABLE vertices {
    vertex_id integer PRIMARY KEY,
    properties json
}

CREATE TABLE edges {
    edge_id integer PRIMARY KEY,
    tail_vertex integer REFERENCES vertices (vertex_id),
    head_vertex integer REFERENCES vertices (vertex_id),
    label text, 
    properties json 
}

CREATE INDEX edges_tails ON edges (tail_vertex)
CREATE INDEX edges_heads ON edges (head_vertex)
```

- 트리플 저장소는 속성 그래프 모델과 같음. 같은 생각을 다른 용어로 설명하는 것. 
